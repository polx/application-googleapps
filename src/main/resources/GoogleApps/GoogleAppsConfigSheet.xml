<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc>
  <web>GoogleApps</web>
  <name>GoogleAppsConfigSheet</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1420066800000</creationDate>
  <parent>GoogleApps.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1550595716000</date>
  <contentUpdateDate>1550595716000</contentUpdateDate>
  <version>1.1</version>
  <title>#if($doc.fullName=="GoogleApps.GoogleAppsConfigSheet")Google Apps Config Sheet#else $doc.title #end</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.0</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity}}
$xwiki.jsx.use('GoogleApps.GoogleAppsConfigClass')
$xwiki.ssx.use('GoogleApps.GoogleAppsConfigClass')

#set($configClassName="GoogleApps.GoogleAppsConfig")
#set($formId = "${section.toLowerCase()}_${configClassName}")
#set($configDoc = $xwiki.getDocument($configClassName))
#set($className="GoogleApps.GoogleAppsConfigClass")
#set($prefix="${configDoc.fullName}_${className}_0")
#set($obj = $configDoc.getObject($className))
## shorthand for t(ranslation) and tp(translation with parameters).
#macro(t $n)##
    $services.localization.render("GoogleApps.GoogleAppsConfigClass_${n}")##
#end
#macro(tp $n $p)##
    $services.localization.render("GoogleApps.GoogleAppsConfigClass_${n}",$p)##
#end
$services.localization.render('googleapps.config.explanation')


{{html wiki=true}}
#set($externalUrlOAuth=$xwiki.getDocument('GoogleApps.OAuth').getExternalURL('view'))
#set($correctedUrl=$externalUrlOAuth.replace('http://','https://'))
#set($externalUrl=$externalUrlOAuth.replace('bin/view/GoogleApps/OAuth',''))

&lt;form id="$formId" method="post" action="$xwiki.getURL($configDoc, 'saveandcontinue')" class="xform"&gt;
    ; $configDoc.display("activate", 'edit', $obj) &lt;label for="${prefix}_activate"&gt;#t("activate")&lt;/label&gt;

    #if(!$externalUrlOAuth.startsWith('https://'))
        &lt;div id="warnIfNotHttps"&gt;{{error}}
          $services.localization.render('googleapps.config.externalUrlNotHttps',[$externalUrl,$correctedUrl])
        {{/error}}&lt;/div&gt;
        ## Your wiki is currently accessed over the URL xxxx but the Google services require the https protocol.
        ## The OAuth process will use yyyy. Please make sure that this is accessible.
    #end


    &lt;fieldset&gt;
        &lt;legend&gt;#t("communicate")&lt;/legend&gt;

        ; &lt;span class="xHint"&gt;##
           #tp("communicate.hint",  ['[[', '&gt;&gt;https://accounts.google.com/ManageDomains]]'])&lt;br&gt;
           #tp("communicate.hint2", ['[[', '&gt;&gt;https://store.xwiki.com/xwiki/bin/view/Extension/GoogleAppsIntegration#installation]]'])&lt;/span&gt;


        ; &lt;label for="${prefix}_clientid"&gt;#t("clientid")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("clientid.hint")&lt;/span&gt;
        : $configDoc.display("clientid", 'edit', $obj)

        ; &lt;label for="${prefix}_secret"&gt;#t("secret")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("secret.hint")&lt;/span&gt;
        : $configDoc.display("secret", 'edit', $obj)

        ## checkboxes for scope, needs JS
        ; &lt;label&gt;#t("scope")&lt;/label&gt; ##
        &lt;span class="xHint"&gt;#t("scope.hint")&lt;/span&gt;
        : &lt;label title="#t('checkbox_mandatory')"&gt; ##
            &lt;input type="checkbox" name="scope_identity" disabled="true" checked&gt;#t("scope_identity")&lt;/label&gt; ##
          &lt;label title="#t('checkbox_mandatory')"&gt; ##
            &lt;input type="checkbox" name="scope_email"    disabled="true" checked&gt;#t("scope_email")&lt;/label&gt; ##
          &lt;label title="#t('checkbox_mandatory')"&gt; ##
            &lt;input type="checkbox" name="scope_gdocs"       disabled="true" checked&gt;#t("scope_gdoc")&lt;/label&gt; ##
          &lt;label title="#t('checkbox_notyetdone')"&gt; ##
            &lt;input type="checkbox" name="scope_avatar"      disabled="true"        &gt;#t("scope_readAvatar")&lt;/label&gt; ##
          &lt;input type="hidden" name="${prefix}_scope"&gt;

        ; &lt;label for="${prefix}_appname"&gt;#t("appname")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("appname.hint")&lt;/span&gt;
        : $configDoc.display("appname", 'edit', $obj)

    &lt;/fieldset&gt;

    &lt;fieldset&gt;
        &lt;legend&gt;#t("loginbehaviour")&lt;/legend&gt;

        ; &lt;label for="${prefix}_domain"&gt;#t("domain")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("domain.hint")&lt;/span&gt;
        : $configDoc.display("domain", 'edit', $obj)&lt;br&gt; ##
          &lt;span id="googleapps-domain-livehint" class="xHint"&gt;&amp;nbsp;&lt;/span&gt;

        ; $configDoc.display("useCookies", 'edit', $obj) &lt;label for="${prefix}_useCookies"&gt;#t("useCookies")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("useCookies.hint")&lt;/span&gt;

        :; $configDoc.display("skipLoginPage", 'edit', $obj) ##
          &lt;label for="${prefix}_skipLoginPage"&gt;#t("skipLoginPage")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("skipLoginPage.hint")&lt;/span&gt;

        :; $configDoc.display("authWithCookies", 'edit', $obj) ##
          &lt;label for="${prefix}_authWithCookies"&gt;#t("authWithCookies")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("authWithCookies.hint")&lt;/span&gt;

        :; &lt;label for="${prefix}_cookiesTTL"&gt;#t("cookiesTTL")&lt;/label&gt; ##
          &lt;span class="xHint"&gt;#t("cookiesTTL.hint")&lt;/span&gt;
        :: $configDoc.display("cookiesTTL", 'edit', $obj)
    &lt;/fieldset&gt;


    ## Hidden form elements
      #set($params="editor=${escapetool.url(${editor})}))&amp;amp;section=${escapetool.url(${section})}")
      #set($params="${params}&amp;amp;space=${escapetool.url(${currentSpace})}")
      #set($continueURL=$xwiki.getURL($currentDoc, 'admin', $params))
      &lt;input type="hidden" name="form_token" value="$!{services.csrf.getToken()}" /&gt;
      &lt;input type="hidden" name="xcontinue" value="${continueURL}" /&gt;
      &lt;input type="hidden" name="xredirect" value="${continueURL}" /&gt;

    ## submit
    &lt;div class="bottombuttons"&gt;
        &lt;p class="admin-buttons"&gt;
            &lt;span class="buttonwrapper"&gt;&lt;input class="button" type="submit" name="formactionsac" ##
              value="$services.localization.render('admin.save')" /&gt;&lt;/span&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/form&gt;


#tp("nowWhat1", ['[[','>>GoogleApps.TestDocumentList]]'])

#tp("nowWhat2", ['##~{~{drive/~}~}##']){{/html}}
{{/velocity}}
</content>
</xwikidoc>
